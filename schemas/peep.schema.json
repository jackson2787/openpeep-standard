{
  "$id": "https://openpeep-standard.org/schemas/peep/2025-08/peep.schema.json",
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "Personal Emergency Evacuation Plan (PEEP)",
  "description": "Resident- or person-specific evacuation plan derived from PCFRA capability outputs and building context. Stores the step-by-step procedure, assistance, communications adjustments, and cross-references to source assessments/statements. Designed for portability and lifecycle management.",
  "type": "object",
  "additionalProperties": false,
  "properties": {
    "schemaVersion": { "type": "string", "pattern": "^\\d+\\.\\d+\\.\\d+$", "description": "Semantic version of the PEEP schema used to validate this document (SEMVER)." },
    "peepId": { "type": "string", "format": "uuid" },
    "personProfile": { "$ref": "https://openpeep-standard.org/schemas/common/person_profile.schema.json" },
    "address": { "$ref": "https://openpeep-standard.org/schemas/common/address.schema.json" },
    "evacuationStrategy": { "type": "string", "enum": ["Stay Put", "Simultaneous Evacuation", "Phased Evacuation", "Partial Evacuation"] },
    "language": { "type": "string", "description": "Primary language code for plan content (ISO 639-1)." },
    "planSummary": { "type": "string", "description": "Plain-language, audience-neutral summary of the evacuation plan. Communicates key actions at-a-glance for residents, staff, and responders. Do not include PCFRA details; link via references." },
    "translations": {
      "type": "array",
      "items": {
        "type": "object",
        "additionalProperties": false,
        "properties": {
          "language": { "type": "string", "description": "Language code (ISO 639-1)." },
          "summary": { "type": "string", "description": "Plain-language summary of the plan in the specified language." }
        },
        "required": ["language", "summary"]
      }
    },
    "metadata": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "createdAt": { "type": "string", "format": "date-time", "description": "When this plan was created (UTC recommended)." },
        "createdBy": { "type": "string", "description": "Author or system identifier at creation time." },
        "method": { "type": "string", "enum": ["self_assessment", "phone_interview", "in_person", "other"], "description": "How the information was obtained." },
        "versionRef": { "type": "string", "description": "External version or change reference, if any." },
        "documentRef": { "type": "string", "format": "uri", "description": "URI or system reference for the canonical record." },
        "status": { "type": "string", "enum": ["draft", "approved", "superseded", "withdrawn"], "description": "Document control status aligned to governance and review lifecycle." }
      },
      "required": ["createdAt", "createdBy", "status"]
    },
    "validity": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "effectiveFrom": { "type": "string", "format": "date", "description": "Date from which this plan is effective." },
        "effectiveTo": { "type": "string", "format": "date", "description": "Date after which this plan should not be used (if set)." }
      }
    },
    "routes": {
      "type": "array",
      "items": {
        "type": "object",
        "additionalProperties": false,
        "properties": {
          "name": { "type": "string", "description": "e.g., Primary, Secondary" },
          "pathDescription": { "type": "string", "description": "Plain-language description of the route." },
          "viaStructuralElements": { "type": "array", "items": { "type": "string" }, "description": "List of corridors, stairs, lobbies or similar identifiers." },
          "assistance": {
            "type": "array",
            "items": {
              "type": "object",
              "additionalProperties": false,
              "properties": {
                "type": { "type": "string", "enum": ["evac_chair", "buddy_pair", "carry_down", "guided_evacuate", "lift_with_attendant"] },
                "personsRequired": { "type": "integer", "minimum": 0 },
                "role": { "type": "string", "description": "Role responsible for this assistance (e.g., concierge team)." },
                "competencyProofRef": { "type": "string", "description": "Reference to training/competency evidence, if recorded elsewhere." },
                "availability": { "type": "string", "description": "Availability window or conditions for assistants, if applicable." },
                "notes": { "type": "string" }
              },
              "required": ["type"]
            }
          },
          "equipment": { "type": "array", "items": { "type": "string" } },
          "refuge": {
            "type": "object",
            "additionalProperties": false,
            "properties": {
              "location": { "type": "string" },
              "waitCondition": { "type": "string" }
            }
          },
          "musterPoint": { "type": "string", "description": "Destination for roll call (if applicable)." },
          "preconditions": { "type": "string", "description": "Conditions that must be satisfied to use this route." },
          "contingency": { "type": "string", "description": "Fallback if this route is untenable or unavailable." },
          "evacuationLiftUse": { "type": "boolean", "description": "Whether this route anticipates using an evacuation lift with appropriate controls/attendants." },
          "notes": { "type": "string" }
        },
        "required": ["name", "pathDescription"]
      }
    },
    "communications": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "alarmHearingAbility": { "type": "string", "enum": ["hears_audible", "needs_visual", "needs_vibration", "unknown"] },
        "alertingMethods": {
          "type": "array",
          "items": { "type": "string", "enum": ["visual_beacons", "vibrating_pager", "text_message", "phone_call", "door_knock", "public_address"] },
          "uniqueItems": true
        },
        "alertingNeeds": {
          "type": "array",
          "items": { "type": "string", "enum": ["visual_beacons", "vibrating_pager", "text_only", "captioned_media", "bsl_interpreter_required", "high_contrast", "large_print", "plain_language"] },
          "uniqueItems": true
        },
        "raiseAlarmMethods": {
          "type": "array",
          "items": { "type": "string", "enum": ["manual_call_point", "pull_cord", "intercom", "phone_call", "call_999", "pendant", "other"] },
          "uniqueItems": true,
          "description": "How the individual can raise the alarm, if required. Enumerated for portability; extend via extensions.* if needed."
        },
        "notes": { "type": "string" }
      }
    },
    "nighttimeConsiderations": { "type": "string" },
    "trainingDrills": { "type": "string" },
    "criticalDependencies": {
      "type": "array",
      "items": {
        "type": "object",
        "additionalProperties": false,
        "properties": {
          "type": { "type": "string", "enum": ["oxygen_support", "power_for_mobility_device", "carer_support", "medication_reminder", "other"] },
          "notes": { "type": "string" }
        },
        "required": ["type"]
      }
    },
    "evacuationProcedure": {
      "type": "array",
      "items": {
        "type": "object",
        "additionalProperties": false,
        "properties": {
          "order": { "type": "integer", "minimum": 1 },
          "instruction": { "type": "string" }
        },
        "required": ["order", "instruction"]
      }
    },
    "responsibilities": {
      "type": "array",
      "items": {
        "type": "object",
        "additionalProperties": false,
        "properties": {
          "role": { "type": "string" },
          "organisation": { "type": "string" },
          "contact": {
            "type": "object",
            "additionalProperties": false,
            "properties": {
              "phone": { "type": "string" },
              "email": { "type": "string", "format": "email" }
            }
          },
          "notes": { "type": "string" }
        },
        "required": ["role"]
      }
    },
    "attachments": {
      "type": "array",
      "items": {
        "type": "object",
        "additionalProperties": false,
        "properties": {
          "label": { "type": "string" },
          "uri": { "type": "string", "format": "uri" },
          "sha256": { "type": "string", "pattern": "^[A-Fa-f0-9]{64}$" }
        },
        "required": ["label", "uri"]
      }
    },
    "references": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "pcfraId": { "type": "string", "description": "Identifier of the source PCFRA informing this plan." },
        "buildingStatementEesId": { "type": "string", "description": "Identifier of the relevant EES building statement." }
      }
    },
    "consent": { "$ref": "https://openpeep-standard.org/schemas/common/consent.schema.json" },
    "review": { "$ref": "https://openpeep-standard.org/schemas/common/review.schema.json" },
    "extensions": {
      "type": "object",
      "description": "Optional jurisdiction or vendor-specific extensions (e.g., gbr, eu, usa, vendor::<orgCode>).",
      "properties": {
        "gbr": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "relevantResident": { "type": "boolean" },
            "residentFacingStatementRef": { "type": "string" },
            "informationDutyEvidenceRef": { "type": "string" },
            "stayingPutBoundary": { "type": "string" }
          }
        },
        "eu": { "type": "object" },
        "usa": { "type": "object" }
      },
      "additionalProperties": true
    }
  },
  "required": ["peepId", "personProfile", "address", "evacuationStrategy", "routes", "evacuationProcedure", "planSummary"]
}