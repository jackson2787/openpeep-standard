{
  "$id": "https://openpeep.org/schemas/2025-08/ees.schema.json",
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "Emergency Evacuation Statements (EES)",
  "type": "object",
  "additionalProperties": false,
  "$defs": {
    "person_statement": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "target_person_id": { "type": "string", "format": "uuid" },
        "plain_language_instructions": { "type": "string", "description": "Clear, accessible instructions for the named person" },
        "assistance_required": {
          "type": "array",
          "items": { "type": "string" },
          "description": "e.g., buddy assistance, evac chair, guidance"
        },
        "equipment": { "type": "array", "items": { "type": "string" } },
        "contact_on_alarm": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "who": { "type": "string" },
            "how": { "type": "string", "description": "e.g., phone, SMS, app notification" }
          }
        },
        "translations": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "language": { "type": "string" },
              "text": { "type": "string" }
            },
            "required": ["language", "text"],
            "additionalProperties": false
          }
        }
      },
      "required": ["plain_language_instructions"]
    }
  },
  "properties": {
    "schema_version": { "type": "string", "pattern": "^\\d+\\.\\d+\\.\\d+$" },
    "ees_id": { "type": "string", "format": "uuid" },
    "address": { "$ref": "https://openpeep.org/schemas/2025-08/common/address.schema.json" },
    "building_statement": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "strategy": {
          "type": "string",
          "enum": ["Stay Put", "Simultaneous Evacuation", "Phased Evacuation", "Partial Evacuation"]
        },
        "instructions": { "type": "string", "description": "Plain-language building-wide instructions" },
        "alarms_info": { "type": "string", "description": "Alarm types, tones, visual alerts" },
        "evacuation_lift": {
          "type": "object",
          "properties": {
            "available": { "type": "boolean" },
            "notes": { "type": "string" }
          },
          "additionalProperties": false
        },
        "refuge_locations": { "type": "array", "items": { "type": "string" } },
        "muster_point": { "type": "string" },
        "stay_put_conditions": { "type": "string", "description": "When 'Stay Put' ceases to apply" },
        "variations_by_level": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": { "level": { "type": "string" }, "instructions": { "type": "string" } },
            "required": ["level", "instructions"],
            "additionalProperties": false
          }
        }
      },
      "required": ["strategy", "instructions"]
    },
    "person_statement": { "$ref": "#/$defs/person_statement" },
    "review": { "$ref": "https://openpeep.org/schemas/2025-08/common/review.schema.json" },
    "metadata": {
      "type": "object",
      "properties": {
        "effective_from": { "type": "string", "format": "date" },
        "effective_to": { "type": "string", "format": "date" },
        "created_by": { "type": "string" }
      },
      "additionalProperties": false
    }
  },
  "required": ["ees_id", "address", "building_statement", "review"]
}